<div class="my-collection-container">
  <div class="header">
    <h2 class="title">{{ TEXT.MY_COLLECTION }}</h2>
    @if (currentMovies.length > 0 && !loading()) {
    <button
      pButton
      severity="danger"
      [label]="clearAllButtonLabel"
      [disabled]="isDeletingAll()"
      (click)="onClearAll()"
    >
      @if (isDeletingAll()) {
      <i class="pi pi-spin pi-spinner"></i>
      } @else {
      <i class="pi pi-trash"></i>
      }
    </button>
    }
  </div>

  <div class="pill-tabs">
    <button
      class="pill-tab"
      [class.active]="activeTab() === 'favourites'"
      (click)="switchTab('favourites')"
    >
      <i class="pi pi-heart"></i>
      <span>{{ TEXT.FAVOURITES }}</span>
    </button>
    <button
      class="pill-tab"
      [class.active]="activeTab() === 'ratings'"
      (click)="switchTab('ratings')"
    >
      <i class="pi pi-star"></i>
      <span>{{ TEXT.MY_RATINGS_NAV }}</span>
    </button>
  </div>

  @if (loading()) {
  <div class="loading-container">
    <p-progressSpinner></p-progressSpinner>
  </div>
  } @else if (currentMovies.length === 0) {
  <div class="empty-state">
    <i class="pi {{ emptyStateIcon }} empty-icon"></i>
    <h3 class="empty-title">{{ emptyStateTitle }}</h3>
    <p class="empty-text">{{ emptyStateSubtitle }}</p>
  </div>
  } @else {
  <div class="content-section">
    <div class="movies-grid">
      @for (movie of currentMovies; track movie.id) {
      <app-movie-card
        [movie]="movie"
        [isFavourite]="isFavourite(movie.id)"
        [userRating]="getUserRating(movie.id)"
        [showFavouriteBadge]="activeTab() === 'favourites'"
        [showRatingBadge]="activeTab() === 'ratings'"
        (movieClick)="onMovieClick($event)"
      ></app-movie-card>
      }
    </div>

    <div class="pagination-section">
      <app-paginator
        [totalRecords]="totalResults"
        [rows]="pageSize"
        [currentPage]="currentPage"
        (pageChange)="onPageChange($event)"
      ></app-paginator>
    </div>
  </div>
  }

  <app-movie-detail-modal
    [movie]="selectedMovie"
    [isFavourite]="selectedMovie ? isFavourite(selectedMovie.id) : false"
    [userRating]="selectedMovie ? getUserRating(selectedMovie.id) : 0"
    (toggleFavourite)="onToggleFavourite($event)"
    (rateMovie)="onRateMovie($event)"
    [(visible)]="showModal"
  ></app-movie-detail-modal>
</div>
