<div class="trending-container">
  <div class="header-section">
    <div class="header-top">
      <h1 class="page-title">
        {{ isSearchMode ? TEXT.SEARCH_RESULTS : TEXT.TRENDING_MOVIES }}
      </h1>

      <!-- ONLY FOR DEMO -->
      <button
        pButton
        icon="pi pi-refresh"
        class="p-button-text p-button-sm cache-button"
        pTooltip="Clear cache and refresh"
        tooltipPosition="bottom"
        [disabled]="loading()"
        (click)="clearCacheAndReload()"
      ></button>
    </div>

    <div class="search-container">
      <div class="search-input-wrapper">
        <i class="pi pi-search search-icon"></i>
        <input
          pInputText
          type="text"
          class="search-input"
          [placeholder]="TEXT.SEARCH_PLACEHOLDER"
          (keyup.enter)="onSearch()"
          [(ngModel)]="searchQuery"
        />
      </div>
      <button
        pButton
        icon="pi pi-search"
        class="search-button"
        [label]="TEXT.SEARCH"
        [disabled]="loading()"
        (click)="onSearch()"
      ></button>
      @if (isSearchMode) {
      <button
        pButton
        [label]="TEXT.CLEAR"
        icon="pi pi-times"
        (click)="loadTrendingMovies(1)"
        class="p-button-secondary clear-button"
      ></button>
      }
    </div>
  </div>

  @if (loading()) {
  <div class="loading-container">
    <p-progressSpinner></p-progressSpinner>
  </div>
  } @if (!loading() && movies.length === 0) {
  <div class="empty-state">
    <i class="pi pi-film empty-icon"></i>
    <p class="empty-text">{{ TEXT.NO_MOVIES_FOUND }}</p>
  </div>
  } @if (!loading() && movies.length > 0) {
  <div class="content-section">
    <div class="movies-grid">
      @for (movie of movies; track movie.id) {
      <app-movie-card
        [movie]="movie"
        [isFavourite]="isFavourite(movie.id)"
        [userRating]="getUserRating(movie.id)"
        (movieClick)="onMovieClick($event)"
      ></app-movie-card>
      }
    </div>

    <div class="pagination-section">
      <app-paginator
        [totalRecords]="totalResults"
        [rows]="20"
        [currentPage]="currentPage"
        (pageChange)="onPageChange($event)"
      ></app-paginator>
    </div>
  </div>
  }
</div>

<app-movie-detail-modal
  [movie]="selectedMovie"
  [isFavourite]="selectedMovie ? isFavourite(selectedMovie.id) : false"
  [userRating]="selectedMovie ? getUserRating(selectedMovie.id) : 0"
  (toggleFavourite)="onToggleFavourite($event)"
  (rateMovie)="onRateMovie($event)"
  [(visible)]="showModal"
></app-movie-detail-modal>
